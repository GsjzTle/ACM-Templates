**问题：**

​	有 $n$ 个小球对应顺序放在 $n$ 个箱子里，现要求重新排列，使得每个小球都不放原来的位置上，求有多少种排列方式？

**错排：**

1. 数学上我们用 $D_n$ 表示有 $n$ 个球 $n$ 个箱子时的方案数。
2. 自己简单算一下可以得出： $D_1=0,D_2=1,D_3=2$
3. 来看下 $D_n(n\ge 4)$ 的情况。要推出怎么做，需要分类讨论。
4. 不妨分成 $n-1$ 种情况： $n$ 号球放进了 $1$ 号箱子， $n$ 号球放进了 $2$ 号箱子… $n$ 号球放进了 $n-1$ 号箱子（ $n$ 号球不能放进 $n$ 号箱子）。

注意，分类讨论时要搞清楚是否涵盖了所有的情况。我们可以把所有情况列出来：

> 把 $n$ 号球放进：
>
> - $1$ 号箱子
> - $2$ 号箱子
> - ……
> - $(k-1)$ 号箱子
> - $k$ 号箱子
> - $(k+1)$ 号箱子
> - ……
> - $(n-1)$ 号箱子

现在，我们只着眼于一种情况： $n$ 号球放进了 $k$ 号箱子。

那么此时对于 $k$ 号小球，就有两种选择：

1. 放入 $n$ 号箱子
2. 不放入 $n$ 号箱子

+ 当$k$号小球放入了$n$号箱子，剩下的$n-2$个小球进行错排，那么答案就是$D_{n-2}$
+ $k$号小球不放入$n$号箱子，可以理解为：
  剩余$n-1$个小球，$1$号小球不能放入$1$号箱子，$2$号小球不能放入$2$号箱子，...... , $k$号小球不能放入$n$号箱子，......，$n - 1$号小球不能放入$n-1$号箱子。然后进行错排，那么答案就是$D_{n-1}$

**所以递推公式： $D_{n} = (n - 1)\times(D_{n-1} + D_{n-2})$ （乘上 $(n -1)$ 是因为 $k$ 有 $n-1$ 种选择）**

**通项公式：$D_{n}=n!\left[{\frac {1}{2!}}-{\frac {1}{3!}}+...+(-1)^{n}{\frac {1}{n!}}\right]$**